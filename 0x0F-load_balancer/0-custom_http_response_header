#!/usr/bin/env bash
# this script configures a server by adding a custom header to the server
path_to_nginx='/etc/nginx/sites-available/default'
is_header=`grep 'add_header X-Served-By' "$path_to_nginx"`

sed -i.bak 's/127\.0\.0\.1 *localhost/127\.0\.0\.1 localhost 03-web-01/g' '/etc/hosts'
hostnamectl set-hostname 03-web-01

if [ -n "$is_header" ]; then
	echo "header X-Served-By already exists"
else
	sed -i.bak "s/^[^#]* *server *{/server {\n\tadd_header X-Served-By $(hostname);/g" "$path_to_nginx"
fi

service nginx restart
